version: '3'
services:  
  smarthome-server:
    environment:
    - SMARTHOME_ENV=${SMARTHOME_ENV}
    image: repo.treescale.com/cecchisandrone/smarthome-server:latest
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 5s
      retries: 3
    restart: always
  smarthome-ui:
    image: repo.treescale.com/cecchisandrone/smarthome-ui:latest
    ports:
    - 80:80
    - 443:443
  smarthome-db:
    environment:
    - MYSQL_ROOT_PASSWORD=${MYSQL_SMARTHOME_ROOT_PASSWORD}
    - MYSQL_DATABASE=${MYSQL_SMARTHOME_DATABASE}
    - MYSQL_USER=${MYSQL_SMARTHOME_USER}
    - MYSQL_PASSWORD=${MYSQL_SMARTHOME_PASSWORD}
    image: hypriot/rpi-mysql
    ports:
    - 4306:3306
    volumes:
    - smarthome-mysql-data:/var/lib/mysql
volumes:
  smarthome-mysql-data:


